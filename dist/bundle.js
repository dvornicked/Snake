(()=>{var t={canvas:null,ctx:null,sprites:{background:null,cell:null,body:null,food:null,head:null,bomb:null},sounds:{bomb:null,food:null,theme:null},width:0,height:0,dimensions:{max:{width:640,height:360},min:{width:300,height:300}},score:0,init:function(){this.canvas=document.getElementById("myCanvas"),this.ctx=this.canvas.getContext("2d"),this.initDimensions(),this.setTextFont()},setTextFont:function(){this.ctx.font="20px Arial",this.ctx.fillStyle="#fff"},initDimensions:function(){var t={maxWidth:this.dimensions.max.width,maxHeight:this.dimensions.max.height,minWidth:this.dimensions.min.width,minHeight:this.dimensions.min.height,realWidth:window.innerWidth,realHeight:window.innerHeight};t.realWidth/t.realHeight>t.maxWidth/t.maxHeight?this.fitWidth(t):this.fitHeight(t),this.canvas.width=this.width,this.canvas.height=this.height},fitHeight:function(t){this.width=Math.round(t.realWidth*t.maxHeight/t.realHeight),this.width=Math.min(this.width,t.maxWidth),this.width=Math.max(this.width,t.minWidth),this.height=Math.round(this.width*t.realHeight/t.realWidth),this.canvas.style.height="100%"},fitWidth:function(t){this.height=Math.round(t.maxWidth*t.realHeight/t.realWidth),this.height=Math.min(this.height,t.maxHeight),this.height=Math.max(this.height,t.minHeight),this.width=Math.round(t.realWidth*this.height/t.realHeight),this.canvas.style.width="100%"},start:function(){var t=this;this.init(),this.preload((function(){t.run()}))},preload:function(t){var i=0,e=Object.keys(this.sprites).length;e+=Object.keys(this.sounds).length;var s=function(){++i>=e&&t()};this.preloadSprites(s),this.preloadAudio(s)},preloadSprites:function(t){for(var i in this.sprites)this.sprites[i]=new Image,this.sprites[i].src="./img/".concat(i,".png"),this.sprites[i].addEventListener("load",t)},preloadAudio:function(t){for(var i in this.sounds)this.sounds[i]=new Audio,this.sounds[i].src="./sounds/".concat(i,".mp3"),this.sounds[i].addEventListener("canplaythrough",t,{once:!0})},create:function(){var t=this;this.board.create(),this.snake.create(),this.board.createFood(),this.board.createBomb(),window.addEventListener("keydown",(function(i){t.snake.start(i.key)}))},render:function(){var t=this;window.requestAnimationFrame((function(){t.ctx.clearRect(0,0,t.width,t.height),t.ctx.drawImage(t.sprites.background,(t.width-t.sprites.background.width)/2,(t.height-t.sprites.background.height)/2),t.board.render(),t.snake.render(),t.ctx.fillText("Score: ".concat(t.score),30,30)}))},update:function(){this.snake.move(),this.render()},run:function(){var t=this;this.create(),this.gameInterval=setInterval((function(){t.update()}),150),this.bombInterval=setInterval((function(){t.snake.moving&&t.board.createBomb()}),3e3)},stop:function(){this.sounds.bomb.play(),clearInterval(this.gameInterval),clearInterval(this.bombInterval),alert("Game over"),window.location.reload()},onSnakeStart:function(){this.sounds.theme.loop=!0,this.sounds.theme.play()},onSnakeEat:function(){++this.score,this.sounds.food.play(),this.board.createFood()},random:function(t,i){return Math.floor(Math.random()*(i-t+1))+t}};t.board={game:t,size:15,cells:[],create:function(){for(var t=0;t<this.size;t++)for(var i=0;i<this.size;i++){var e=this.createCell(t,i);this.cells.push(e)}},createCell:function(t,i){var e=this.game.sprites.cell.width+1;return{row:t,col:i,x:e*i+(this.game.width-e*this.size)/2,y:e*t+(this.game.height-e*this.size)/2}},render:function(){var t=this;this.cells.forEach((function(i){t.game.ctx.drawImage(t.game.sprites.cell,i.x,i.y),i.type&&t.game.ctx.drawImage(t.game.sprites[i.type],i.x,i.y)}))},getCell:function(t,i){return this.cells.find((function(e){return e.row===t&&e.col===i}))},createCellObject:function(t){var i=this.cells.find((function(i){return i.type===t}));i&&(i.type=!1),(i=this.getRandomAvailableCell()).type=t},createFood:function(){this.createCellObject("food")},createBomb:function(){this.createCellObject("bomb")},getRandomAvailableCell:function(){var t=this,i=this.cells.filter((function(i){return!i.type&&!t.game.snake.hasCell(i)}));return i[this.game.random(0,i.length-1)]},isFoodCell:function(t){return"food"===t.type},isBombCell:function(t){return"bomb"===t.type}},t.snake={game:t,cells:[],moving:!1,direction:!1,directions:{up:{row:-1,col:0,angle:0},down:{row:1,col:0,angle:180},left:{row:0,col:-1,angle:270},right:{row:0,col:1,angle:90}},create:function(){this.direction=this.directions.up;for(var t=0,i=[{row:7,col:7},{row:8,col:7}];t<i.length;t++){var e=i[t],s=this.game.board.getCell(e.row,e.col);this.cells.push(s)}},renderHead:function(){var t=this.cells[0],i=this.game.sprites.head.width/2;this.game.ctx.save(),this.game.ctx.translate(t.x+i,t.y+i);var e=this.direction.angle;this.game.ctx.rotate(e*Math.PI/180),this.game.ctx.drawImage(this.game.sprites.head,-i,-i),this.game.ctx.restore()},renderBody:function(){for(var t=1;t<this.cells.length;t++)this.game.ctx.drawImage(this.game.sprites.body,this.cells[t].x,this.cells[t].y)},render:function(){this.renderHead(),this.renderBody()},start:function(t){switch(t){case"ArrowUp":this.direction=this.directions.up;break;case"ArrowDown":this.direction=this.directions.down;break;case"ArrowLeft":this.direction=this.directions.left;break;case"ArrowRight":this.direction=this.directions.right}this.moving||this.game.onSnakeStart(),this.moving=!0},move:function(){if(this.moving){var t=this.getNextCell();!t||this.hasCell(t)||this.game.board.isBombCell(t)?this.game.stop():(this.cells.unshift(t),this.game.board.isFoodCell(t)?this.game.onSnakeEat():this.cells.pop())}},getNextCell:function(){var t=this.cells[0],i=t.row+this.direction.row,e=t.col+this.direction.col;return this.game.board.getCell(i,e)},hasCell:function(t){return this.cells.find((function(i){return i===t}))}},t.start()})();